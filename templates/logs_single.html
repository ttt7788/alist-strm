{% extends 'index.html' %}

{% block content %}
<div class="container mt-4">
    <h4 class="mb-3">日志内容 (配置 ID: {{ config_id }})</h4>

    <!-- 返回配置文件按钮，右上角定位 -->
    <a href="{{ url_for('configs') }}" class="btn btn-primary btn-sm" id="back-button" style="position: fixed; top: 10px; right: 10px;">
        返回配置文件
    </a>

    <!-- 显示日志内容，字体缩小，限制高度并加滚动条 -->
    <div id="log-content" style="font-size: 14px; background-color: #f8f9fa; padding: 15px; height: 600px; overflow-y: auto; border: 1px solid #ddd;">
        {{ log_content | safe }}
    </div>

    <!-- 自动刷新提示 -->
    <div class="d-flex justify-content-between mt-2">
        <div class="text-muted small" id="auto-refresh-status">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 正在实时更新日志...
        </div>
        <div class="text-muted small">
            只显示最新的 2000 行日志
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var configId = {{ config_id }};
        var logContentDiv = document.getElementById('log-content');
        var refreshStatus = document.getElementById('auto-refresh-status');
        
        // 自动刷新逻辑
        setInterval(function() {
            fetch('/api/logs/' + configId)
                .then(response => response.json())
                .then(data => {
                    if (data.content) {
                        // 检查内容是否有变化，避免不必要的 DOM 更新（可选优化，这里直接更新）
                        if (logContentDiv.innerHTML !== data.content) {
                            logContentDiv.innerHTML = data.content;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching logs:', error);
                    refreshStatus.innerHTML = '<span class="text-danger">更新失败</span>';
                });
        }, 3000); // 每3秒刷新一次
    });
</script>
{% endblock %}
